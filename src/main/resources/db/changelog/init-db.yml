databaseChangeLog:
  - changeSet:
      id: create-base-tables
      author: angella
      changes:
        - createTable:
            tableName: usr
            columns:
              - column:
                  name: id
                  type: bigserial
                  constraints:
                    primaryKey: true
              - column:
                  name: created_at
                  type: timestamp with time zone
              - column:
                  name: updated_at
                  type: timestamp with time zone
              - column:
                  name: email
                  type: varchar(255)
                  constraints:
                    unique: true
              - column:
                  name: first_name
                  type: varchar(255)
              - column:
                  name: last_name
                  type: varchar(255)
              - column:
                  name: password
                  type: varchar(255)
              - column:
                  name: username
                  type: varchar(255)
                  constraints:
                    unique: true
              - column:
                  name: avatar_image_id
                  type: bigint

        - createTable:
            tableName: category
            columns:
              - column:
                  name: id
                  type: bigserial
                  constraints:
                    primaryKey: true
              - column:
                  name: created_at
                  type: timestamp with time zone
              - column:
                  name: updated_at
                  type: timestamp with time zone
              - column:
                  name: name
                  type: varchar(255)
                  constraints:
                    unique: true

        - createTable:
            tableName: location
            columns:
              - column:
                  name: id
                  type: bigserial
                  constraints:
                    primaryKey: true
              - column:
                  name: created_at
                  type: timestamp with time zone
              - column:
                  name: updated_at
                  type: timestamp with time zone
              - column:
                  name: city
                  type: varchar(255)
              - column:
                  name: street
                  type: varchar(255)

        - createTable:
            tableName: checklist_template
            columns:
              - column:
                  name: id
                  type: bigserial
                  constraints:
                    primaryKey: true
              - column:
                  name: created_at
                  type: timestamp with time zone
              - column:
                  name: updated_at
                  type: timestamp with time zone
              - column:
                  name: name
                  type: varchar(255)
                  constraints:
                    nullable: false
              - column:
                  name: description
                  type: text
              - column:
                  name: category
                  type: varchar(50)

  - changeSet:
      id: create-event-related-tables
      author: angella
      changes:
        - createTable:
            tableName: event
            columns:
              - column:
                  name: id
                  type: bigserial
                  constraints:
                    primaryKey: true
              - column:
                  name: created_at
                  type: timestamp with time zone
              - column:
                  name: updated_at
                  type: timestamp with time zone
              - column:
                  name: end_time
                  type: timestamp with time zone
                  constraints:
                    nullable: false
              - column:
                  name: name
                  type: varchar(255)
                  constraints:
                    nullable: false
              - column:
                  name: start_time
                  type: timestamp with time zone
                  constraints:
                    nullable: false
              - column:
                  name: location_id
                  type: bigint
              - column:
                  name: creator_id
                  type: bigint
              - column:
                  name: description
                  type: text
                  constraints:
                    nullable: false

        - createTable:
            tableName: chat_message
            columns:
              - column:
                  name: id
                  type: bigserial
                  constraints:
                    primaryKey: true
              - column:
                  name: created_at
                  type: timestamp with time zone
              - column:
                  name: updated_at
                  type: timestamp with time zone
              - column:
                  name: content
                  type: text
                  constraints:
                    nullable: false
              - column:
                  name: edited
                  type: boolean
                  defaultValue: false
              - column:
                  name: event_id
                  type: bigint
              - column:
                  name: user_id
                  type: bigint

  - changeSet:
      id: create-image-table
      author: angella
      changes:
        - createTable:
            tableName: image
            columns:
              - column:
                  name: id
                  type: bigserial
                  constraints:
                    primaryKey: true
              - column:
                  name: created_at
                  type: timestamp with time zone
              - column:
                  name: updated_at
                  type: timestamp with time zone
              - column:
                  name: filename
                  type: varchar(255)
                  constraints:
                    nullable: false
              - column:
                  name: original_filename
                  type: varchar(255)
                  constraints:
                    nullable: false
              - column:
                  name: content_type
                  type: varchar(100)
                  constraints:
                    nullable: false
              - column:
                  name: size
                  type: bigint
              - column:
                  name: file_path
                  type: varchar(500)
                  constraints:
                    nullable: false
              - column:
                  name: user_id
                  type: bigint
              - column:
                  name: event_id
                  type: bigint
              - column:
                  name: chat_message_id
                  type: bigint

  - changeSet:
      id: create-remaining-tables
      author: angella
      changes:
        - createTable:
            tableName: user_roles
            columns:
              - column:
                  name: user_id
                  type: bigint
              - column:
                  name: roles
                  type: varchar(255)

        - createTable:
            tableName: comment
            columns:
              - column:
                  name: id
                  type: bigserial
                  constraints:
                    primaryKey: true
              - column:
                  name: created_at
                  type: timestamp with time zone
              - column:
                  name: updated_at
                  type: timestamp with time zone
              - column:
                  name: text
                  type: varchar(255)
                  constraints:
                    nullable: false
              - column:
                  name: event_id
                  type: bigint
              - column:
                  name: user_id
                  type: bigint

        - createTable:
            tableName: events_participants
            columns:
              - column:
                  name: event_id
                  type: bigint
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: user_id
                  type: bigint
                  constraints:
                    primaryKey: true
                    nullable: false

        - createTable:
            tableName: event_categories
            columns:
              - column:
                  name: event_id
                  type: bigint
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: category_id
                  type: bigint
                  constraints:
                    primaryKey: true
                    nullable: false

        - createTable:
            tableName: task
            columns:
              - column:
                  name: id
                  type: bigserial
                  constraints:
                    primaryKey: true
              - column:
                  name: created_at
                  type: timestamp with time zone
              - column:
                  name: updated_at
                  type: timestamp with time zone
              - column:
                  name: description
                  type: text
                  constraints:
                    nullable: false
              - column:
                  name: completed
                  type: boolean
                  defaultValue: false
              - column:
                  name: event_id
                  type: bigint
              - column:
                  name: user_id
                  type: bigint
              - column:
                  name: assigned_user_id
                  type: bigint

        - createTable:
            tableName: checklist_item
            columns:
              - column:
                  name: id
                  type: bigserial
                  constraints:
                    primaryKey: true
              - column:
                  name: created_at
                  type: timestamp with time zone
              - column:
                  name: updated_at
                  type: timestamp with time zone
              - column:
                  name: name
                  type: varchar(255)
                  constraints:
                    nullable: false
              - column:
                  name: description
                  type: text
              - column:
                  name: quantity
                  type: integer
                  defaultValue: 1
              - column:
                  name: completed
                  type: boolean
                  defaultValue: false
              - column:
                  name: from_template
                  type: boolean
                  defaultValue: false
              - column:
                  name: event_id
                  type: bigint
              - column:
                  name: assigned_user_id
                  type: bigint
              - column:
                  name: created_by_id
                  type: bigint

        - createTable:
            tableName: template_item
            columns:
              - column:
                  name: id
                  type: bigserial
                  constraints:
                    primaryKey: true
              - column:
                  name: created_at
                  type: timestamp with time zone
              - column:
                  name: updated_at
                  type: timestamp with time zone
              - column:
                  name: name
                  type: varchar(255)
                  constraints:
                    nullable: false
              - column:
                  name: description
                  type: text
              - column:
                  name: default_quantity
                  type: integer
                  defaultValue: 1
              - column:
                  name: template_id
                  type: bigint

  - changeSet:
      id: add-constraints-and-indexes
      author: angella
      changes:
        - addUniqueConstraint:
            columnNames: user_id, roles
            constraintName: usr_role_unique
            tableName: user_roles

        - addForeignKeyConstraint:
            baseTableName: usr
            baseColumnNames: avatar_image_id
            referencedTableName: image
            referencedColumnNames: id
            constraintName: fk_user_avatar_image_id

        - addForeignKeyConstraint:
            baseTableName: user_roles
            baseColumnNames: user_id
            referencedTableName: usr
            referencedColumnNames: id
            constraintName: fk_user_roles_user_id

        - addForeignKeyConstraint:
            baseTableName: event
            baseColumnNames: location_id
            referencedTableName: location
            referencedColumnNames: id
            constraintName: fk_event_location_id

        - addForeignKeyConstraint:
            baseTableName: event
            baseColumnNames: creator_id
            referencedTableName: usr
            referencedColumnNames: id
            constraintName: fk_event_creator_id

        - addForeignKeyConstraint:
            baseTableName: chat_message
            baseColumnNames: event_id
            referencedTableName: event
            referencedColumnNames: id
            constraintName: fk_chat_message_event_id

        - addForeignKeyConstraint:
            baseTableName: chat_message
            baseColumnNames: user_id
            referencedTableName: usr
            referencedColumnNames: id
            constraintName: fk_chat_message_user_id

        - addForeignKeyConstraint:
            baseTableName: image
            baseColumnNames: user_id
            referencedTableName: usr
            referencedColumnNames: id
            constraintName: fk_image_user_id

        - addForeignKeyConstraint:
            baseTableName: image
            baseColumnNames: event_id
            referencedTableName: event
            referencedColumnNames: id
            constraintName: fk_image_event_id

        - addForeignKeyConstraint:
            baseTableName: image
            baseColumnNames: chat_message_id
            referencedTableName: chat_message
            referencedColumnNames: id
            constraintName: fk_image_chat_message_id

        - addForeignKeyConstraint:
            baseTableName: comment
            baseColumnNames: event_id
            referencedTableName: event
            referencedColumnNames: id
            constraintName: fk_comment_event_id

        - addForeignKeyConstraint:
            baseTableName: comment
            baseColumnNames: user_id
            referencedTableName: usr
            referencedColumnNames: id
            constraintName: fk_comment_user_id

        - addForeignKeyConstraint:
            baseTableName: events_participants
            baseColumnNames: event_id
            referencedTableName: event
            referencedColumnNames: id
            constraintName: fk_evt_part_event_id

        - addForeignKeyConstraint:
            baseTableName: events_participants
            baseColumnNames: user_id
            referencedTableName: usr
            referencedColumnNames: id
            constraintName: fk_evt_part_user_id

        - addForeignKeyConstraint:
            baseTableName: event_categories
            baseColumnNames: event_id
            referencedTableName: event
            referencedColumnNames: id
            constraintName: fk_evt_cat_event_id

        - addForeignKeyConstraint:
            baseTableName: event_categories
            baseColumnNames: category_id
            referencedTableName: category
            referencedColumnNames: id
            constraintName: fk_evt_cat_cat_id

        - addForeignKeyConstraint:
            baseTableName: task
            baseColumnNames: event_id
            referencedTableName: event
            referencedColumnNames: id
            constraintName: fk_task_event_id

        - addForeignKeyConstraint:
            baseTableName: task
            baseColumnNames: user_id
            referencedTableName: usr
            referencedColumnNames: id
            constraintName: fk_task_user_id

        - addForeignKeyConstraint:
            baseTableName: task
            baseColumnNames: assigned_user_id
            referencedTableName: usr
            referencedColumnNames: id
            constraintName: fk_task_assigned_user_id

        - addForeignKeyConstraint:
            baseTableName: checklist_item
            baseColumnNames: event_id
            referencedTableName: event
            referencedColumnNames: id
            constraintName: fk_checklist_item_event_id

        - addForeignKeyConstraint:
            baseTableName: checklist_item
            baseColumnNames: assigned_user_id
            referencedTableName: usr
            referencedColumnNames: id
            constraintName: fk_checklist_item_assigned_user_id

        - addForeignKeyConstraint:
            baseTableName: checklist_item
            baseColumnNames: created_by_id
            referencedTableName: usr
            referencedColumnNames: id
            constraintName: fk_checklist_item_created_by_id

        - addForeignKeyConstraint:
            baseTableName: template_item
            baseColumnNames: template_id
            referencedTableName: checklist_template
            referencedColumnNames: id
            constraintName: fk_template_item_template_id